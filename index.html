<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oficina de Bombas - Controle de OS</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #e9ecef; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        
        /* Grid para formul√°rio */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        
        label { font-weight: bold; font-size: 0.9em; color: #555; display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 14px; }
        textarea { resize: vertical; height: 80px; }
        
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 15px; transition: background 0.3s; }
        button:hover { background: #0056b3; }

        /* Estilo dos Cards de Hist√≥rico */
        .card { background: #fff; border-left: 5px solid #ddd; margin-top: 15px; padding: 15px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px;}
        .card-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em; color: #444; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; text-transform: uppercase; }
        
        /* Cores dos status */
        .status-pendente { border-left-color: #ffc107; } .tag-pendente { background: #fff3cd; color: #856404; }
        .status-manutencao { border-left-color: #17a2b8; } .tag-manutencao { background: #d1ecf1; color: #0c5460; }
        .status-pronto { border-left-color: #28a745; } .tag-pronto { background: #d4edda; color: #155724; }
        .status-entregue { border-left-color: #6c757d; opacity: 0.8; } .tag-entregue { background: #e2e3e5; color: #383d41; }
        
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } .full-width { grid-column: span 1; } }
    </style>
</head>
<body>

<div class="container">
    <h2>Nova Ordem de Servi√ßo</h2>
    <form id="form-os">
        <div class="form-grid">
            <div>
                <label>N¬∫ da OS (ID)</label>
                <input type="text" name="ID" id="id_os" placeholder="Ex: 1050" required>
            </div>
            <div>
                <label>Data de Entrada</label>
                <input type="date" name="Data_Entrada" id="data_entrada" required>
            </div>

            <div class="full-width">
                <label>Nome do Cliente</label>
                <input type="text" name="Cliente" placeholder="Nome completo" required>
            </div>
            
            <div>
                <label>WhatsApp (DDD+N√∫mero)</label>
                <input type="tel" name="Telefone" placeholder="Ex: 11999998888" required>
            </div>
            <div>
                <label>Status Atual</label>
                <select name="Status">
                    <option value="Aguardando Avalia√ß√£o">Aguardando Avalia√ß√£o</option>
                    <option value="Em Manuten√ß√£o">Em Manuten√ß√£o</option>
                    <option value="Aguardando Pe√ßa">Aguardando Pe√ßa</option>
                    <option value="Pronto">Pronto</option>
                    <option value="Entregue">Entregue</option>
                </select>
            </div>

            <div>
                <label>Equipamento</label>
                <input type="text" name="Equipamento" placeholder="Ex: Bomba Centr√≠fuga" required>
            </div>
            <div>
                <label>Voltagem</label>
                <select name="Voltagem">
                    <option value="110v">110v / 127v</option>
                    <option value="220v Mono">220v Monof√°sica</option>
                    <option value="220v Trif">220v Trif√°sica</option>
                    <option value="380v">380v Trif√°sica</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>

            <div class="full-width">
                <label>Acess√≥rios (O que veio junto?)</label>
                <input type="text" name="Acessorios" placeholder="Ex: V√°lvula de p√©, curva, niple, sem tampa...">
            </div>

            <div class="full-width">
                <label>Defeito Relatado (Cliente)</label>
                <input type="text" name="Defeito" placeholder="O que o cliente disse que est√° acontecendo?">
            </div>

            <div class="full-width">
                <label>Diagn√≥stico (Pe√ßas com Defeito)</label>
                <textarea name="Diagnostico" placeholder="Liste aqui as pe√ßas quebradas encontradas na avalia√ß√£o..."></textarea>
            </div>
            
            <div class="full-width">
                <label>Pe√ßas Trocadas / Servi√ßo Feito</label>
                <textarea name="Pecas_Trocadas" placeholder="O que foi efetivamente trocado ou reparado..."></textarea>
            </div>

            <div>
                <label>Data de Sa√≠da (Opcional)</label>
                <input type="date" name="Data_Saida">
            </div>
        </div>

        <button type="submit" id="btn-salvar">üíæ Salvar Ordem de Servi√ßo</button>
    </form>
</div>

<div class="container" style="margin-top: 20px;">
    <h2>√öltimas Manuten√ß√µes</h2>
    <div id="lista-os">Carregando hist√≥rico...</div>
</div>

<script>
    // --- COLOQUE SEU LINK AQUI DENTRO DAS ASPAS ---
    const scriptURL = https://script.google.com/macros/s/AKfycbxyoZcOqdg6j6U5NKdKPwUZ7yAvUcLrEuUzoWGU-rwHSKQo4EZdtwy70Vor7CCYjVAgzg/exec; 
    // ----------------------------------------------

    // Preenche a data de hoje automaticamente
    document.getElementById('data_entrada').valueAsDate = new Date();

    const form = document.forms['form-os'];
    const lista = document.getElementById('lista-os');

    form.addEventListener('submit', e => {
        e.preventDefault();
        const btn = document.getElementById('btn-salvar');
        btn.innerText = "Enviando dados...";
        btn.disabled = true;

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                alert("‚úÖ OS Salva com Sucesso!");
                form.reset();
                document.getElementById('data_entrada').valueAsDate = new Date(); 
                btn.innerText = "üíæ Salvar Ordem de Servi√ßo";
                btn.disabled = false;
                carregarOS();
            })
            .catch(error => {
                console.error('Erro!', error.message);
                alert("Erro ao salvar. Verifique a internet.");
                btn.disabled = false;
            })
    });

    function carregarOS() {
        lista.innerHTML = "<p style='text-align:center'>Atualizando lista...</p>";
        fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
            lista.innerHTML = "";
            data.forEach(linha => {
                // √çndices das colunas (IMPORTANTE: Se mudar a planilha, muda aqui):
                // 0:ID, 1:Entrada, 2:Saida, 3:Cliente, 4:Tel, 5:Equip, 6:Volts, 7:Acessorios, 8:Defeito, 9:Diag, 10:Pecas, 11:Status
                
                let dataEnt = linha[1] ? new Date(linha[1]).toLocaleDateString('pt-BR') : '-';
                
                // Define cor do status
                let classeStatus = 'status-pendente';
                let classeTag = 'tag-pendente';
                if(linha[11] && linha[11].includes('Pronto')) { classeStatus = 'status-pronto'; classeTag = 'tag-pronto'; }
                if(linha[11] && linha[11].includes('Manuten√ß√£o')) { classeStatus = 'status-manutencao'; classeTag = 'tag-manutencao'; }
                if(linha[11] && linha[11].includes('Entregue')) { classeStatus = 'status-entregue'; classeTag = 'tag-entregue'; }

                let html = `
                <div class="card ${classeStatus}">
                    <div class="card-header">
                        <strong>#${linha[0]} - ${linha[3]}</strong>
                        <span class="status-badge ${classeTag}">${linha[11]}</span>
                    </div>
                    
                    <div class="card-details">
                        <div>üìÖ Entrada: ${dataEnt}</div>
                        <div>‚ö° Tens√£o: ${linha[6]}</div>
                        <div style="grid-column: span 2">‚öôÔ∏è Equip: ${linha[5]}</div>
                        <div style="grid-column: span 2; font-style: italic; color:#666;">üì¶ Acess√≥rios: ${linha[7] || "Nenhum"}</div>
                        <div style="grid-column: span 2">üîß Defeito: ${linha[8]}</div>
                        ${linha[9] ? `<div style="grid-column: span 2; color:#d63031"><strong>‚ö†Ô∏è Diagn√≥stico:</strong> ${linha[9]}</div>` : ''}
                        ${linha[10] ? `<div style="grid-column: span 2; color:#0984e3"><strong>‚úÖ Feito:</strong> ${linha[10]}</div>` : ''}
                    </div>

                    <div style="margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                        <a href="https://wa.me/55${linha[4]}?text=Ol√° ${linha[3]}, referente √† bomba ${linha[5]} (OS ${linha[0]})..." 
                           target="_blank" style="text-decoration:none; color:#28a745; font-weight:bold;">
                           üì≤ Mandar WhatsApp
                        </a>
                    </div>
                </div>
                `;
                lista.innerHTML += html;
            });
        });
    }

    carregarOS();
</script>

</body>
</html>
